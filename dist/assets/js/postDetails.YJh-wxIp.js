import{getApps as C,initializeApp as S}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";import{a as I,o as h}from"./index-a7d5cfcc.rqyF9t_j.js";import{g as A,a as T,c as x,d as l,b,u as d,e as _,j as q}from"./index.esm2017.FicD-Q5F.js";const F={apiKey:"AIzaSyALbJJCcRibFqa7HVcadIYAgBBzbTREkiY",authDomain:"hustlersathome-b9bee.firebaseapp.com",databaseURL:"https://hustlersathome-b9bee-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"hustlersathome-b9bee",storageBucket:"hustlersathome-b9bee.appspot.com",messagingSenderId:"447459076084",appId:"1:447459076084:web:f26efa8cd4e33523a63ba1",measurementId:"G-5S6WET94BS"};C().length?C()[0]:S(F);const B=I(),w=A();async function E(e,o){const n=document.getElementById("reviews-list");n.textContent="";const t=await T(x(w,`posts/${e}/reviews`));if(t.empty){const s=document.createElement("p");s.textContent="No reviews yet. Be the first to leave a review!",n.appendChild(s)}t.forEach(s=>{const a=s.data(),c=document.createElement("div");c.classList.add("review");const r=document.createElement("div");r.classList.add("review-username"),r.textContent=a.account;const i=document.createElement("div");i.classList.add("review-rating"),i.textContent=`Rating: ${"â˜…".repeat(a.starRating)}`;const y=document.createElement("div");y.classList.add("review-text"),y.textContent=a.reviewText,c.appendChild(r),c.appendChild(i),c.appendChild(y),h(B,u=>{if(u&&u.uid===a.userId){const p=document.createElement("div");p.classList.add("rev-buttons-container");const m=document.createElement("button");m.textContent="Edit",m.classList.add("btn","btn-secondary"),m.addEventListener("click",()=>k(s.id,e,a,o));const f=document.createElement("button");f.textContent="Delete",f.classList.add("btn","btn-danger"),f.addEventListener("click",()=>$(s.id,e,a,o)),p.append(m,f),c.appendChild(p)}}),n.appendChild(c)})}async function P(e,o,n,t){const s=B.currentUser;if(!s){alert("You must be logged in to submit a review.");return}const a=s.displayName||"Anonymous";try{await q(x(w,`posts/${e}/reviews`),{reviewText:o,account:a,userId:s.uid,starRating:n,timestamp:new Date}),alert("Review submitted successfully!"),console.log(t.uid),n>=4?await D(n,t.uid):n===3?await z(n,t.uid):await M(n,t.uid),E(e,t)}catch(c){console.error("Error submitting review:",c),alert("Failed to submit review.")}}async function k(e,o,n,t){const s=prompt("Edit your review:",n.reviewText),a=prompt("Edit your rating (1-5):",n.starRating);s&&a&&await N(e,o,s,parseInt(a,10),t)}async function N(e,o,n,t,s){let a;try{const c=l(w,`posts/${o}/reviews`,e),r=await b(c);r.exists()&&(a=r.data().starRating)}catch(c){console.error("Error retrieving review:",c)}try{await d(l(w,`posts/${o}/reviews`,e),{reviewText:n,starRating:t,timestamp:new Date}),alert("Review updated successfully!"),a!=t&&U(a,t,s.uid),E(o,s)}catch(c){console.error("Error updating review:",c),alert("Failed to update review.")}}async function $(e,o,n,t){if(confirm("Are you sure you want to delete this review?"))try{await _(l(w,`posts/${o}/reviews`,e)),alert("Review deleted successfully!"),W(n.starRating,t.uid),E(o,t)}catch(s){console.error("Error deleting review:",s),alert("Failed to delete review.")}}function G(e,o){const n=document.getElementById("review-input-section");h(B,t=>{if(t){const s=l(w,"posts",e);b(s).then(a=>{if(a.exists()){const c=a.data(),r=c.uid;if(t.uid===r){const i=document.createElement("p");i.classList.add("alert","alert-warning"),i.textContent="You cannot leave a review for your own post.",n.appendChild(i)}else{const i=document.createElement("textarea");i.id="review-text",i.classList.add("form-control"),i.rows=3,i.placeholder="Write your review here...";const y=document.createElement("span");y.innerText="Stars (rate from 1 to 5): ";const u=document.createElement("select");u.id="review-star",u.classList.add("form-control","mt-2");for(let m=1;m<=5;m++){const f=document.createElement("option");f.value=m,f.textContent=m,u.appendChild(f)}const p=document.createElement("button");p.id="submit-review",p.classList.add("btn","btn-primary","mt-2"),p.textContent="Submit Review",n.appendChild(i),n.appendChild(y),n.appendChild(u),n.appendChild(p),p.addEventListener("click",()=>{const m=i.value,f=parseInt(u.value);P(e,m,f,c),i.value="",u.value="1"})}}}).catch(a=>{console.error("Error fetching post data:",a)})}else{const s=document.createElement("p");s.classList.add("alert","alert-warning"),s.textContent="You must be logged in to leave a review.",n.appendChild(s)}})}async function D(e,o){const n=l(w,"report",o);try{const t=await b(n);if(t.exists()){const s=t.data().reviews||0,a=t.data().good||0,c=t.data().total_stars||0;await d(n,{reviews:s+1,good:a+1,total_stars:c+e}),console.log("Field updated successfully!")}else console.log("No such document!")}catch(t){console.error("Error updating document: ",t)}}async function M(e,o){const n=l(w,"report",o);try{const t=await b(n);if(t.exists()){const s=t.data().reviews||0,a=t.data().bad||0,c=t.data().total_stars||0;await d(n,{reviews:s+1,bad:a+1,total_stars:c+e}),console.log("Field updated successfully!")}else console.log("No such document!")}catch(t){console.error("Error updating document: ",t)}}async function z(e,o){const n=l(w,"report",o);try{const t=await b(n);if(t.exists()){const s=t.data().reviews||0,a=t.data().total_stars||0;await d(n,{reviews:s+1,total_stars:a+e}),console.log("Field updated successfully!")}else console.log("No such document!")}catch(t){console.error("Error updating document: ",t)}}async function U(e,o,n){const t=l(w,"report",n);try{const s=await b(t);if(console.log("found"),s.exists()){const a=s.data().total_stars||0,c=s.data().bad||0,r=s.data().good||0;console.log("founded"),e>o?(console.log("foundfounded"),e>3&&o==3&&await d(t,{good:r-1,total_stars:a-(e-o)}),e==3&&o<3&&await d(t,{bad:c+1,total_stars:a-(e-o)}),e==3&&o>3&&await d(t,{good:r+1,total_stars:a-(e-o)}),e>3&&o<3&&(console.log("working right"),await d(t,{bad:c+1,good:r-1,total_stars:a-(e-o)}))):(console.log("foundfounded"),o>3&&e==3&&await d(t,{good:r+1,total_stars:a+(o-e)}),o==3&&e<3&&await d(t,{bad:c-1,total_stars:a+(o-e)}),o==3&&e>3&&await d(t,{good:r-1,total_stars:a+(o-e)}),o>3&&e<3&&await d(t,{bad:c-1,good:r+1,total_stars:a+(o-e)})),console.log("Field updated successfully!")}else console.log("No such document!")}catch(s){console.error("Error updating document: ",s)}}async function W(e,o){const n=l(w,"report",o);try{const t=await b(n);if(t.exists()){const s=t.data().reviews||0,a=t.data().total_stars||0,c=t.data().bad||0,r=t.data().good||0;console.log("checking"),e>3&&await d(n,{reviews:s-1,good:r-1,total_stars:a-e}),e==3&&await d(n,{reviews:s-1,total_stars:a-e}),e<3&&await d(n,{reviews:s-1,bad:currrentBad-1,total_stars:a-e}),console.log("Field updated successfully!")}else console.log("No such document!")}catch(t){console.error("Error updating document: ",t)}}const Y={apiKey:"AIzaSyALbJJCcRibFqa7HVcadIYAgBBzbTREkiY",authDomain:"hustlersathome-b9bee.firebaseapp.com",databaseURL:"https://hustlersathome-b9bee-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"hustlersathome-b9bee",storageBucket:"hustlersathome-b9bee.appspot.com",messagingSenderId:"447459076084",appId:"1:447459076084:web:f26efa8cd4e33523a63ba1",measurementId:"G-5S6WET94BS"};C().length?C()[0]:S(Y);const L=I(),v=A(),j=new URLSearchParams(window.location.search),g=j.get("id"),J="AIzaSyA6-vawo-lbppb1emyFd5h-91IEMyeC_4A";async function K(){const e=document.getElementById("post-details");if(!g){e.textContent="Post not found.";return}const o=l(v,"posts",g),n=await b(o);if(!n.exists()){e.textContent="No such post exists.";return}const t=n.data();O(e,t),E(g,t),G(g),h(L,s=>{if(s&&s.uid===t.uid){const a=document.getElementById("addToCartButton");a&&(a.style.display="none")}})}function O(e,o){const n=e.querySelector(".post-title");n.textContent=o.itemName;const t=e.querySelector(".post-description");t.textContent="Description: ";const s=document.createElement("span");s.classList.add("editable-content"),s.textContent=o.postDescription,t.appendChild(s);const a=e.querySelector(".post-category");a.textContent="Category: ";const c=document.createElement("span");c.classList.add("editable-content"),c.textContent=o.category,a.appendChild(c);const r=e.querySelector(".post-price");r.textContent=`Price: SGD ${o.price}`;const i=e.querySelector(".post-account");i.textContent=`Posted by: ${o.account}`;const y=e.querySelector(".post-image");y.src=o.imageUrl,y.alt=o.itemName;const u=document.getElementById("addToCartButton");u&&u.addEventListener("click",()=>ee(o)),o.mrtStationName&&H(o.mrtStationName),h(L,p=>{p&&p.uid===o.uid&&Q()})}function H(e){const o=document.createElement("script");o.src=`https://maps.googleapis.com/maps/api/js?key=${J}&callback=initMapWithGeocoding`,o.async=!0,document.head.appendChild(o),window.initMapWithGeocoding=function(){V(e)}}function V(e){const o=document.getElementById("map");new google.maps.Geocoder().geocode({address:e},(t,s)=>{if(s==="OK"&&t.length>0){const{lat:a,lng:c}=t[0].geometry.location,r={center:{lat:a(),lng:c()},zoom:15},i=new google.maps.Map(o,r);new google.maps.Marker({position:{lat:a(),lng:c()},map:i,title:e})}else o.textContent="Location not found."})}function Q(){const e=document.createElement("div");e.classList.add("buttons-container");const o=document.createElement("button");o.textContent="Edit Post",o.classList.add("btn","btn-warning"),o.addEventListener("click",R);const n=document.createElement("button");n.textContent="Delete Post",n.classList.add("btn","btn-danger"),n.addEventListener("click",()=>Z(g));const t=document.createElement("button");t.textContent="Save Changes",t.classList.add("btn","btn-success"),t.style.display="none",t.addEventListener("click",X),e.append(o,n,t),document.getElementById("map").insertAdjacentElement("afterend",e),e.saveButton=t}function R(){const e=document.querySelector(".post-title"),o=document.querySelector(".post-description .editable-content"),n=document.querySelector(".post-category .editable-content");e.contentEditable="true",o.contentEditable="true",e.classList.add("editable-field"),o.classList.add("editable-field");const t=document.createElement("select");t.classList.add("category-dropdown"),["Crafts","Fashion","Food","Services"].forEach(r=>{const i=document.createElement("option");i.value=r,i.textContent=r,r===n.textContent&&(i.selected=!0),t.appendChild(i)}),n.replaceWith(t);const a=document.getElementById("addToCartButton");a&&(a.style.display="none");const c=document.querySelector(".buttons-container");c.saveButton.style.display="inline-block"}async function X(){const e=document.querySelector(".post-title"),o=document.querySelector(".post-description .editable-content"),n=document.querySelector(".post-category .category-dropdown");try{await d(l(v,"posts",g),{itemName:e.textContent,postDescription:o.textContent,category:n.value}),alert("Post updated successfully!"),location.reload()}catch(t){console.error("Error updating post:",t),alert("Failed to update post.")}}async function Z(e){if(confirm("Are you sure you want to delete this post?"))try{await _(l(v,"posts",e)),document.getElementById("post-details").textContent="Post has been deleted.",setTimeout(()=>window.location.href="/userPosts.html",2e3)}catch(o){console.error("Error deleting post:",o),alert("Failed to delete post.")}}window.onload=K;async function ee(e){h(L,async o=>{if(o)try{const n=x(v,`users/${o.uid}/cart`),t=await T(n);let s=null;if(t.forEach(a=>{a.data().itemId===g&&(s=a)}),s){const a=s.data().quantity+1,c=e.price*a;await d(l(v,`users/${o.uid}/cart`,s.id),{quantity:a,totalPrice:c}),alert("Item quantity updated in cart!")}else await q(n,{itemId:g,itemName:e.itemName,itemPrice:e.price,itemImage:e.imageUrl,account:e.account,sellerUid:e.uid,quantity:1,totalPrice:e.price,timestamp:new Date}),alert("Item added to cart!")}catch(n){console.error("Error adding to cart:",n)}else window.location.href="/login.html"})}
