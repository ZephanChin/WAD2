import{g as x,i as B,a as R,o as q}from"./index-a7d5cfcc.rqyF9t_j.js";import{g as F,c as T,a as N,s as O,d as U,e as G}from"./index.esm2017.FicD-Q5F.js";const z={apiKey:"AIzaSyALbJJCcRibFqa7HVcadIYAgBBzbTREkiY",authDomain:"hustlersathome-b9bee.firebaseapp.com",databaseURL:"https://hustlersathome-b9bee-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"hustlersathome-b9bee",storageBucket:"hustlersathome-b9bee.appspot.com",messagingSenderId:"447459076084",appId:"1:447459076084:web:f26efa8cd4e33523a63ba1",measurementId:"G-5S6WET94BS"};let I;x().length?I=x()[0]:I=B(z);const w=R(I),S=F(I);async function K(t,l){console.log(`Deleting cart item with ID: ${l}`);const f=U(S,`users/${t}/cart/${l}`);try{await G(f),console.log("Item deleted successfully."),alert("Item deleted from cart."),A({uid:t})}catch(d){console.error("Error deleting item:",d)}}function Y(t){for(;t.firstChild;)t.removeChild(t.firstChild)}async function A(t){console.log("Fetching cart items for user:",t.uid);const l=document.getElementById("cart-items-container");Y(l);const f=T(S,`users/${t.uid}/cart`),d=await N(f);if(d.empty){console.log("Cart is empty.");const e=document.createElement("p");e.textContent="Your cart is empty.",l.appendChild(e);return}const n={};let C=0,b=[];d.forEach(e=>{const o=e.data();b.push(o);const p=e.id,i=o.account;n[i]||(n[i]={});const r=`${o.itemName}-${o.itemPrice}`,h=o.quantity||1;n[i][r]?n[i][r].quantity+=h:n[i][r]={...o,cartItemId:p,quantity:h}}),console.log("Grouped items by seller:",n);for(const e in n){console.log(`Displaying items for seller: ${e}`);const o=document.createElement("div");o.classList.add("seller-section");const p=document.createElement("h2");p.textContent=`Make Purchase from: ${e}`,o.appendChild(p);for(const i in n[e]){const r=n[e][i],{quantity:h,itemPrice:D,itemName:c,itemImage:u,cartItemId:P}=r,$=D*h;C+=$,console.log("Displaying item:",r);const g=document.createElement("div");g.classList.add("cart-item");const y=document.createElement("img");y.src=u,y.alt=c,y.classList.add("cart-item-image");const k=document.createElement("h3");k.textContent=c;const L=document.createElement("p");L.textContent=`Quantity: ${h}`;const v=document.createElement("p");v.textContent=`Total Price: SGD ${$.toFixed(2)}`;const E=document.createElement("button");E.textContent="Remove",E.classList.add("btn","delete-button"),E.addEventListener("click",()=>K(t.uid,P)),g.appendChild(y),g.appendChild(k),g.appendChild(L),g.appendChild(v),g.appendChild(E),o.appendChild(g)}l.appendChild(o)}console.log("Total price of items in cart:",C);const s=document.createElement("div");s.classList.add("total-container");const m=document.createElement("p");m.classList.add("total-price"),m.textContent=`Total Cart Price: SGD ${C.toFixed(2)}`,s.appendChild(m);const a=document.createElement("button");a.textContent="Checkout",a.classList.add("btn","checkout-button"),a.addEventListener("click",()=>{J(b),console.log("Proceeding to checkout.")}),s.appendChild(a),l.appendChild(s)}q(w,t=>{t?(console.log("User authenticated:",t.uid),A(t)):(console.log("User not authenticated. Redirecting to login page."),window.location.href="/login.html")});const J=async t=>{t.sort((a,e)=>a.sellerUid-e.sellerUid);const l=w.currentUser,f=w.currentUser.displayName,d=l.uid,n=d.substring(0,3),C=d.substring(10,13),b=new Date().toISOString();let s="",m={};t.forEach(a=>{let e=a.sellerUid;m[e]||(m[e]=[]),m[e].push(a)});for(const[a,e]of Object.entries(m)){const o=e[0].sellerUid.substring(0,3);s=n+C+b.substring(8,13)+b.substring(20,24)+o;let p=0,i=0,r={};e.forEach(c=>{const u=[];u.push(c.itemName),u.push(c.itemPrice),u.push(c.quantity),u.push(c.totalPrice),u.push(c.itemImage);const P="Item"+i.toString();r[P]=u,p+=c.totalPrice,i+=1});let h={OrderID:s,PlaceDate:new Date,TotalPrice:p,account:f,sellaccount:e[0].account,selluid:a,status:"Ongoing",uid:d},D={Items:r,...h};try{await O(U(T(S,"porders"),s),D),console.log(`Document ${s} successfully written!`)}catch(c){console.error(`Error writing document ${s}: `,c)}}window.location.href="/checkout.html"};
