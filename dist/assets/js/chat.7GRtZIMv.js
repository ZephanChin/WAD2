import{i as D,a as M}from"./index-a7d5cfcc.rqyF9t_j.js";import{g as $,c as p,q as R,o as k,b as A,d as y,a as x,h as N,i as _,j as F,u as q,e as z}from"./index.esm2017.FicD-Q5F.js";import{g as Y,r as j,b as J,a as G}from"./index.esm2017.BPQr0z8j.js";const H={apiKey:"AIzaSyALbJJCcRibFqa7HVcadIYAgBBzbTREkiY",authDomain:"hustlersathome-b9bee.firebaseapp.com",databaseURL:"https://hustlersathome-b9bee-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"hustlersathome-b9bee",storageBucket:"hustlersathome-b9bee.appspot.com",messagingSenderId:"447459076084",appId:"1:447459076084:web:f26efa8cd4e33523a63ba1",measurementId:"G-5S6WET94BS"},B=D(H),d=M(B),m=$(B),K=Y();let L=[];async function O(){try{const e=p(m,"users_chat");L=(await x(e)).docs.map(s=>({id:s.id,...s.data()})),E()}catch(e){console.error("Error fetching users:",e)}}function E(e=""){const t=document.getElementById("user-list");for(;t.firstChild;)t.removeChild(t.firstChild);const s=d.currentUser?d.currentUser.email:null;localStorage.setItem("searchTerm",e),L.filter(n=>(n.displayName||"").toLowerCase().includes(e.toLowerCase())).forEach(n=>{const{displayName:o,email:r}=n;if(o&&r&&r!==s){const c=document.createElement("button");c.textContent=o,c.classList.add("user-button"),c.addEventListener("click",()=>{v(n.id),V(c)}),t.appendChild(c)}})}document.addEventListener("DOMContentLoaded",()=>{const e=localStorage.getItem("currentChatId"),t=localStorage.getItem("searchTerm");e&&Q(e),t&&E(t)});function Q(e){const t=d.currentUser;if(t){const s=e.split("_").find(a=>a!==t.uid);v(s)}}document.getElementById("search-bar").addEventListener("input",e=>{const t=e.target.value.trim();E(t)});function V(e){document.querySelectorAll(".user-button").forEach(t=>t.classList.remove("highlight")),e.classList.add("highlight")}function W(e,t){return e<t?`${e}_${t}`:`${t}_${e}`}function v(e){const t=d.currentUser;if(!t){console.error("User is not authenticated.");return}const s=W(t.uid,e);localStorage.setItem("currentChatId",s);const a=p(m,"chats",s,"messages"),n=R(a,k("timestamp"));let o=null,r=null;A(y(m,"users_chat",e)).then(l=>{if(l.exists()){const u=l.data();r=u.displayName||u.email;const i=document.getElementById("chat-title"),C=`Chat with ${r} today!`;x(a).then(g=>{g.empty?i.textContent=C:i.textContent=`Chatting with ${r}`}).catch(g=>{console.error("Error checking messages:",g)}),N(n,g=>{const h=document.getElementById("messages-container");for(;h.firstChild;)h.removeChild(h.firstChild);let b=!1;g.forEach(I=>{const f={id:I.id,...I.data()},w=f.senderId===t.uid,S=f.senderId===o,T=P(f,w,S,s);h.appendChild(T),o=f.senderId,b=!0}),b?i.textContent=`Chatting with ${r}`:i.textContent=C})}}).catch(l=>{console.error("Error fetching user details:",l)});const c=document.getElementById("send-button");c.onclick=()=>te(s)}function X(e,t,s,a){e.addEventListener("contextmenu",n=>{n.preventDefault();const o=a?new Date(a.seconds*1e3).toLocaleString():"No timestamp",r=document.getElementById("message-menu");r.style.left=`${n.pageX}px`,r.style.top=`${n.pageY}px`,r.style.display="block";const c=document.getElementById("message-timestamp");c.textContent=`${o}`,document.getElementById("edit-message").onclick=()=>Z(s,t),document.getElementById("delete-message").onclick=()=>ee(s,t)})}document.addEventListener("click",e=>{const t=document.getElementById("message-menu");e.target.closest("#message-menu")===null&&(t.style.display="none")});function P(e,t,s,a){const n=document.createElement("div");if(n.classList.add("message",t?"user":"other"),e.text&&!e.imageUrl){const o=document.createElement("p");o.textContent=e.text,n.appendChild(o)}if(e.imageUrl){const o=document.createElement("img");o.src=e.imageUrl,o.classList.add("message-image"),n.appendChild(o)}return s&&n.classList.add("continuation"),t&&X(n,e.id,a,e.timestamp),n}function Z(e,t){console.log("chatId:",e,"messageId:",t);const s=prompt("Edit your message:");if(s!==null){const a=y(m,"chats",e,"messages",t);q(a,{text:s}).then(()=>console.log("Message updated successfully.")).catch(n=>console.error("Error updating message:",n))}}function ee(e,t){if(confirm("Are you sure you want to delete this message?")){const a=y(m,"chats",e,"messages",t);z(a).then(()=>console.log("Message deleted successfully.")).catch(n=>console.error("Error deleting message:",n))}}function te(e){const t=document.getElementById("message-input"),s=document.getElementById("image-input"),a=document.getElementById("upload-image-button"),n=t.value.trim(),o=d.currentUser;if(!o||!n&&s.files.length===0){console.error("Message cannot be empty.");return}const r={senderId:o.uid,timestamp:_(),seen:!1};if(n&&(r.text=n),s.files.length>0){const c=s.files[0],l=j(K,`chats/${e}/${c.name}`),u=J(l,c);u.on("state_changed",null,i=>console.error("Upload error:",i),()=>{G(u.snapshot.ref).then(i=>{r.imageUrl=i,U(e,r),a.textContent="Upload Image"})})}else U(e,r);t.value="",s.value="",s.addEventListener("change",()=>{a.textContent="Upload Image"})}function U(e,t){const s=p(m,"chats",e,"messages");F(s,t).then(()=>{console.log("Message sent successfully.")}).catch(a=>{console.error("Error sending message: ",a)})}d.onAuthStateChanged(e=>{e?O():window.location.href="login.html"});
